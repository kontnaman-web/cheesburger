<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cheese Surfers – Endless Runner</title>
  <style>
    body { margin:0; background:#222; font-family:Arial, sans-serif; color:#fff; overflow:hidden; }
    canvas { display:block; margin:0 auto; background:linear-gradient(#87CEEB, #E0F7FA); }
    #ui {
      position:absolute; top:10px; left:10px; right:10px; z-index:10;
      display:flex; justify-content:space-between; font-size:24px; pointer-events:none;
    }
    #gameOver {
      position:absolute; inset:0; background:rgba(0,0,0,0.8);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      font-size:48px; color:#ff4444; pointer-events:all; display:none;
    }
    button { font-size:32px; padding:15px 40px; margin:20px; cursor:pointer; }
  </style>
</head>
<body>

<div id="ui">
  <div>Score: <span id="score">0</span></div>
  <div>Highscore: <span id="highscore">0</span></div>
</div>

<canvas id="canvas"></canvas>

<div id="gameOver">
  <div>GAME OVER</div>
  <div>Score: <span id="finalScore">0</span></div>
  <button onclick="restart()">Nochmal!</button>
</div>

<script>
// === Cheese Surfers – Simple 2D Endless Runner ===
// Controls: Pfeiltasten ← → ↑ ↓  oder  Swipe / Touch

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const highscoreEl = document.getElementById('highscore');
const gameOverEl = document.getElementById('gameOver');
const finalScoreEl = document.getElementById('finalScore');

canvas.width = 480;
canvas.height = 720;

let score = 0;
let highscore = localStorage.getItem('highscore') || 0;
highscoreEl.textContent = highscore;

let gameRunning = true;
let speed = 8;          // wie schnell die Welt kommt
let laneWidth = canvas.width / 3;
let playerLane = 1;     // 0=left, 1=middle, 2=right
let playerY = canvas.height - 120;
let playerSize = 80;
let isJumping = false;
let isDucking = false;
let jumpVelocity = -18;
let gravity = 1.2;
let velocityY = 0;

let obstacles = [];
let coins = [];
let lastObstacleTime = 0;
let lastCoinTime = 0;

// Swipe detection
let touchStartX = 0;
canvas.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; });
canvas.addEventListener('touchend', e => {
  let touchEndX = e.changedTouches[0].clientX;
  let diff = touchEndX - touchStartX;
  if (Math.abs(diff) > 60) {
    if (diff > 0) moveRight();
    else moveLeft();
  }
});

window.addEventListener('keydown', e => {
  if (!gameRunning) return;
  if (e.key === 'ArrowLeft' || e.key === 'a') moveLeft();
  if (e.key === 'ArrowRight' || e.key === 'd') moveRight();
  if (e.key === 'ArrowUp' || e.key === 'w' || e.key === ' ') jump();
  if (e.key === 'ArrowDown' || e.key === 's') duck();
});

function moveLeft()  { if (playerLane > 0) playerLane--; }
function moveRight() { if (playerLane < 2) playerLane++; }
function jump() {
  if (!isJumping && !isDucking) {
    velocityY = jumpVelocity;
    isJumping = true;
  }
}
function duck() {
  if (!isJumping) isDucking = true;
}

function restart() {
  score = 0;
  scoreEl.textContent = 0;
  speed = 8;
  obstacles = [];
  coins = [];
  playerLane = 1;
  playerY = canvas.height - 120;
  isJumping = false;
  isDucking = false;
  velocityY = 0;
  gameRunning = true;
  gameOverEl.style.display = 'none';
  loop();
}

function spawnObstacle() {
  const lane = Math.floor(Math.random() * 3);
  const type = Math.random() > 0.4 ? 'train' : 'wall'; // train = hoch, wall = niedrig
  obstacles.push({
    x: lane * laneWidth + (laneWidth - 100)/2,
    y: -150,
    width: 100,
    height: type === 'train' ? 200 : 80,
    type
  });
}

function spawnCoin() {
  const lane = Math.floor(Math.random() * 3);
  coins.push({
    x: lane * laneWidth + laneWidth/2 - 20,
    y: -50,
    size: 40
  });
}

function checkCollision(a, b) {
  return a.x < b.x + b.width &&
         a.x + a.width > b.x &&
         a.y < b.y + b.height &&
         a.y + a.height > b.y;
}

function update() {
  if (!gameRunning) return;

  score += 0.1;
  scoreEl.textContent = Math.floor(score);

  // Speed increase over time
  if (score > 200 && speed < 16) speed += 0.0005;

  // Player physics
  velocityY += gravity;
  playerY += velocityY;

  if (playerY >= canvas.height - 120) {
    playerY = canvas.height - 120;
    velocityY = 0;
    isJumping = false;
  }

  if (isDucking && playerY >= canvas.height - 120) {
    setTimeout(() => isDucking = false, 800);
  }

  // Spawn stuff
  if (Date.now() - lastObstacleTime > 1800 - score*2) {
    spawnObstacle();
    lastObstacleTime = Date.now();
  }
  if (Date.now() - lastCoinTime > 1200) {
    spawnCoin();
    lastCoinTime = Date.now();
  }

  // Move world
  obstacles.forEach((obs, i) => {
    obs.y += speed;
    if (obs.y > canvas.height + 100) obstacles.splice(i, 1);

    let playerBox = {
      x: playerLane * laneWidth + (laneWidth - playerSize)/2,
      y: isDucking ? playerY + 40 : playerY,
      width: playerSize,
      height: isDucking ? 40 : playerSize
    };

    if (checkCollision(playerBox, obs)) {
      gameRunning = false;
      finalScoreEl.textContent = Math.floor(score);
      if (score > highscore) {
        highscore = Math.floor(score);
        localStorage.setItem('highscore', highscore);
        highscoreEl.textContent = highscore;
      }
      gameOverEl.style.display = 'flex';
    }
  });

  coins.forEach((coin, i) => {
    coin.y += speed;
    if (coin.y > canvas.height + 50) coins.splice(i, 1);

    let playerBox = {
      x: playerLane * laneWidth + (laneWidth - playerSize)/2,
      y: playerY,
      width: playerSize,
      height: playerSize
    };

    if (checkCollision(playerBox, {x:coin.x-20, y:coin.y-20, width:80, height:80})) {
      coins.splice(i, 1);
      score += 50;
      scoreEl.textContent = Math.floor(score);
    }
  });
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Gleise (einfach)
  ctx.fillStyle = '#555';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Linien
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 8;
  for (let i=1; i<3; i++) {
    ctx.beginPath();
    ctx.moveTo(i*laneWidth, 0);
    ctx.lineTo(i*laneWidth, canvas.height);
    ctx.stroke();
  }

  // Player (einfacher Cheeseburger-Charakter :D)
  ctx.fillStyle = '#f28c38';
  ctx.fillRect(
    playerLane * laneWidth + (laneWidth - playerSize)/2,
    isDucking ? playerY + 40 : playerY,
    playerSize,
    isDucking ? 40 : playerSize
  );
  // Augen
  ctx.fillStyle = '#fff';
  ctx.fillRect(playerLane * laneWidth + laneWidth/2 - 15, playerY + 20, 10, 10);
  ctx.fillRect(playerLane * laneWidth + laneWidth/2 + 5, playerY + 20, 10, 10);

  // Obstacles
  obstacles.forEach(obs => {
    ctx.fillStyle = obs.type === 'train' ? '#c00' : '#444';
    ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
  });

  // Coins
  coins.forEach(coin => {
    ctx.fillStyle = '#ffeb3b';
    ctx.beginPath();
    ctx.arc(coin.x, coin.y, coin.size/2, 0, Math.PI*2);
    ctx.fill();
  });
}

function loop() {
  if (!gameRunning) return;
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
