<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Flappy Game</title>
</head>
<body>

<canvas id="game" width="400" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let birdY = 200;
let velocity = 0;
const gravity = 0.5;
const jumpPower = -8;

let pipes = [];
let frame = 0;
let alive = true;
let score = 0;

function jump() {
  if (!alive) {
    birdY = 200;
    velocity = 0;
    pipes = [];
    frame = 0;
    score = 0;
    alive = true;
    loop();
    return;
  }
  velocity = jumpPower;
}

document.addEventListener("click", jump);
document.addEventListener("keydown", jump);

function addPipe() {
  const gap = 130;
  const topHeight = Math.random() * 200 + 50;
  pipes.push({
    x: canvas.width,
    top: topHeight,
    bottom: topHeight + gap,
    passed: false
  });
}

function loop() {
  if (!alive) return;

  ctx.clearRect(0, 0, 400, 500);

  // Vogel
  velocity += gravity;
  birdY += velocity;
  ctx.fillStyle = "yellow";
  ctx.fillRect(80, birdY, 30, 30);

  // Boden / Decke
  if (birdY < 0 || birdY > 470) alive = false;

  // Rohre
  if (frame % 90 === 0) addPipe();

  ctx.fillStyle = "green";
  pipes.forEach(pipe => {
    pipe.x -= 2;

    ctx.fillRect(pipe.x, 0, 50, pipe.top);
    ctx.fillRect(pipe.x, pipe.bottom, 50, 500);

    // Kollision
    if (
      80 < pipe.x + 50 &&
      110 > pipe.x &&
      (birdY < pipe.top || birdY + 30 > pipe.bottom)
    ) alive = false;

    // Punkte
    if (!pipe.passed && pipe.x + 50 < 80) {
      pipe.passed = true;
      score++;
    }
  });

  pipes = pipes.filter(p => p.x > -50);

  // Score
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 30);

  if (!alive) {
    ctx.fillText("GAME OVER - klick zum Neustart", 60, 250);
    return;
  }

  frame++;
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
